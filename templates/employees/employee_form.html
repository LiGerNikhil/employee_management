{% extends layout_path %}

{% load static %}
{% load i18n %}
{% load widget_tweaks %}

{% block title %}
  {% if title %}{{ title }}{% else %}Employee Form{% endif %} | {% get_theme_variables 'template_name' %} - {% get_theme_variables 'template_suffix' %}
{% endblock %}


{% block content %}
  <div class="row justify-content-center">
    <div class="col-xl-8 col-lg-10 col-md-12">
      <div class="card">
        <div class="card-header">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <h5 class="card-title m-0">
                {% if title %}{{ title }}{% else %}Employee Information{% endif %}
              </h5>
              <small class="text-muted">
                {% if form.instance.pk %}Update employee details{% else %}Add new employee to the system{% endif %}
              </small>
            </div>
            <a href="{% url 'employees:employee_list' %}" class="btn btn-outline-secondary btn-sm">
              <i class="icon-base bx bx-arrow-back me-1"></i>Back to List
            </a>
          </div>
        </div>

        <div class="card-body">
          {% if messages %}
            {% for message in messages %}
              <div class="alert {% if message.tags == 'error' %}alert-danger{% else %}alert-{{ message.tags }}{% endif %} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            {% endfor %}
          {% endif %}

          <form method="post" enctype="multipart/form-data" novalidate>
            {% csrf_token %}

            <!-- Basic Information -->
            <div class="row mb-4">
              <div class="col-12">
                <h6 class="text-primary mb-3">Basic Information</h6>
              </div>
              <div class="col-md-6 mb-3">
                <label for="{{ form.name.id_for_label }}" class="form-label">
                  {{ form.name.label }}
                  {% if form.name.field.required %}<span class="text-danger">*</span>{% endif %}
                </label>
                {% render_field form.name class="form-control" %}
                {% if form.name.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in form.name.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                {% endif %}
                {% if form.name.help_text %}
                  <small class="text-muted">{{ form.name.help_text }}</small>
                {% endif %}
              </div>
              <div class="col-md-6 mb-3">
                <label for="{{ form.full_name.id_for_label }}" class="form-label">
                  {{ form.full_name.label }}
                  {% if form.full_name.field.required %}<span class="text-danger">*</span>{% endif %}
                </label>
                {% render_field form.full_name class="form-control" %}
                {% if form.full_name.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in form.full_name.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                {% endif %}
                {% if form.full_name.help_text %}
                  <small class="text-muted">{{ form.full_name.help_text }}</small>
                {% endif %}
              </div>
              <div class="col-md-6 mb-3">
                <label for="{{ form.email.id_for_label }}" class="form-label">
                  {{ form.email.label }}
                  {% if form.email.field.required %}<span class="text-danger">*</span>{% endif %}
                </label>
                {% render_field form.email class="form-control" %}
                {% if form.email.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in form.email.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                {% endif %}
                {% if form.email.help_text %}
                  <small class="text-muted">{{ form.email.help_text }}</small>
                {% endif %}
              </div>
              <div class="col-md-6 mb-3">
                <label for="{{ form.contact.id_for_label }}" class="form-label">
                  {{ form.contact.label }}
                  {% if form.contact.field.required %}<span class="text-danger">*</span>{% endif %}
                </label>
                {% render_field form.contact class="form-control" %}
                {% if form.contact.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in form.contact.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                {% endif %}
                {% if form.contact.help_text %}
                  <small class="text-muted">{{ form.contact.help_text }}</small>
                {% endif %}
              </div>
            </div>

            <!-- Financial Information -->
            <div class="row mb-4">
              <div class="col-12">
                <h6 class="text-primary mb-3">Financial Information</h6>
              </div>
              <div class="col-md-6 mb-3">
                <label for="{{ form.aadhar_card_number.id_for_label }}" class="form-label">
                  {{ form.aadhar_card_number.label }}
                  {% if form.aadhar_card_number.field.required %}<span class="text-danger">*</span>{% endif %}
                </label>
                {% render_field form.aadhar_card_number class="form-control" maxlength="12" %}
                {% if form.aadhar_card_number.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in form.aadhar_card_number.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                {% endif %}
                {% if form.aadhar_card_number.help_text %}
                  <small class="text-muted">{{ form.aadhar_card_number.help_text }}</small>
                {% endif %}
              </div>
              <div class="col-md-6 mb-3">
                <label for="{{ form.pan_card.id_for_label }}" class="form-label">
                  {{ form.pan_card.label }}
                  {% if form.pan_card.field.required %}<span class="text-danger">*</span>{% endif %}
                </label>
                {% render_field form.pan_card class="form-control" maxlength="10" style="text-transform: uppercase;" %}
                {% if form.pan_card.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in form.pan_card.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                {% endif %}
                {% if form.pan_card.help_text %}
                  <small class="text-muted">{{ form.pan_card.help_text }}</small>
                {% endif %}
              </div>
              <div class="col-md-6 mb-3">
                <label for="{{ form.account_number.id_for_label }}" class="form-label">
                  {{ form.account_number.label }}
                  {% if form.account_number.field.required %}<span class="text-danger">*</span>{% endif %}
                </label>
                {% render_field form.account_number class="form-control" %}
                {% if form.account_number.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in form.account_number.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                {% endif %}
                {% if form.account_number.help_text %}
                  <small class="text-muted">{{ form.account_number.help_text }}</small>
                {% endif %}
              </div>
              <div class="col-md-6 mb-3">
                <label for="{{ form.ifsc_code.id_for_label }}" class="form-label">
                  {{ form.ifsc_code.label }}
                  {% if form.ifsc_code.field.required %}<span class="text-danger">*</span>{% endif %}
                </label>
                {% render_field form.ifsc_code class="form-control" maxlength="11" style="text-transform: uppercase;" %}
                {% if form.ifsc_code.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in form.ifsc_code.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                {% endif %}
                {% if form.ifsc_code.help_text %}
                  <small class="text-muted">{{ form.ifsc_code.help_text }}</small>
                {% endif %}
              </div>
            </div>

            <!-- Address Information -->
            <div class="row mb-4">
              <div class="col-12">
                <h6 class="text-primary mb-3">Address Information</h6>
              </div>
              <div class="col-md-6 mb-3">
                <label for="{{ form.current_address.id_for_label }}" class="form-label">
                  {{ form.current_address.label }}
                  {% if form.current_address.field.required %}<span class="text-danger">*</span>{% endif %}
                </label>
                {% render_field form.current_address class="form-control" rows="3" %}
                {% if form.current_address.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in form.current_address.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                {% endif %}
                {% if form.current_address.help_text %}
                  <small class="text-muted">{{ form.current_address.help_text }}</small>
                {% endif %}
              </div>
              <div class="col-md-6 mb-3">
                <div class="form-check form-switch mb-2">
                  <input class="form-check-input" type="checkbox" id="sameAsCurrentAddress">
                  <label class="form-check-label" for="sameAsCurrentAddress">Same as Current Address</label>
                </div>
                <label for="{{ form.permanent_address.id_for_label }}" class="form-label">
                  {{ form.permanent_address.label }}
                  {% if form.permanent_address.field.required %}<span class="text-danger">*</span>{% endif %}
                </label>
                {% render_field form.permanent_address class="form-control" rows="3" %}
                {% if form.permanent_address.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in form.permanent_address.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                {% endif %}
                {% if form.permanent_address.help_text %}
                  <small class="text-muted">{{ form.permanent_address.help_text }}</small>
                {% endif %}
              </div>
            </div>

            <!-- Relative Information -->
            <div class="row mb-4">
              <div class="col-12">
                <h6 class="text-primary mb-3">Emergency Contact Information</h6>
              </div>
              <div class="col-md-4 mb-3">
                <label for="{{ form.relative_name.id_for_label }}" class="form-label">
                  {{ form.relative_name.label }}
                  {% if form.relative_name.field.required %}<span class="text-danger">*</span>{% endif %}
                </label>
                {% render_field form.relative_name class="form-control" %}
                {% if form.relative_name.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in form.relative_name.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                {% endif %}
                {% if form.relative_name.help_text %}
                  <small class="text-muted">{{ form.relative_name.help_text }}</small>
                {% endif %}
              </div>
              <div class="col-md-4 mb-3">
                <label for="{{ form.relation_with_employee.id_for_label }}" class="form-label">
                  {{ form.relation_with_employee.label }}
                  {% if form.relation_with_employee.field.required %}<span class="text-danger">*</span>{% endif %}
                </label>
                {% render_field form.relation_with_employee class="form-control" %}
                {% if form.relation_with_employee.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in form.relation_with_employee.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                {% endif %}
                {% if form.relation_with_employee.help_text %}
                  <small class="text-muted">{{ form.relation_with_employee.help_text }}</small>
                {% endif %}
              </div>
              <div class="col-md-4 mb-3">
                <label for="{{ form.relative_contact.id_for_label }}" class="form-label">
                  {{ form.relative_contact.label }}
                  {% if form.relative_contact.field.required %}<span class="text-danger">*</span>{% endif %}
                </label>
                {% render_field form.relative_contact class="form-control" %}
                {% if form.relative_contact.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in form.relative_contact.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                {% endif %}
                {% if form.relative_contact.help_text %}
                  <small class="text-muted">{{ form.relative_contact.help_text }}</small>
                {% endif %}
              </div>
            </div>

            <!-- Profile Picture with Face Registration -->
            <div class="row mb-4">
              <div class="col-12">
                <h6 class="text-primary mb-3">Face Registration</h6>
                <div class="alert alert-info">
                  <i class="icon-base bx bx-face me-1"></i>
                  <strong>Face Recognition Setup:</strong> Please capture or upload a clear photo of the employee's face for identity verification during check-ins. This enables automatic face matching.
                </div>
              </div>

              <!-- Camera Interface (for new employees) -->
              {% if not form.instance.pk %}
                <div class="col-md-6 mb-3">
                  <div class="camera-section">
                    <!-- Camera Preview -->
                    <div class="camera-container mb-3">
                      <video id="profile-camera" class="camera-preview" autoplay playsinline muted></video>
                      <canvas id="profile-canvas" class="d-none"></canvas>
                    </div>

                    <!-- Camera Controls -->
                    <div class="camera-controls mb-3">
                      <button type="button" id="profile-start-camera-btn" class="btn btn-primary me-2">
                        <i class="icon-base bx bx-video me-1"></i>Start Camera
                      </button>
                      <button type="button" id="profile-capture-btn" class="btn btn-success me-2" disabled>
                        <i class="icon-base bx bx-camera me-1"></i>Capture Face
                      </button>
                      <button type="button" id="profile-retake-btn" class="btn btn-outline-secondary d-none">
                        <i class="icon-base bx bx-refresh me-1"></i>Retake
                      </button>
                    </div>

                    <!-- Photo Preview -->
                    <div id="profile-photo-preview" class="d-none mb-3">
                      <img id="profile-captured-photo" class="photo-preview" alt="Profile photo">
                      <div id="face-status" class="mt-2">
                        <small class="text-muted">Processing face recognition...</small>
                      </div>
                    </div>

                    <!-- Hidden inputs for face data -->
                    <input type="hidden" name="profile_photo_data" id="profile-photo-data" accept="image/*">
                    <input type="hidden" name="face_encoding_data" id="face-encoding-data">
                  </div>
                </div>
              {% endif %}

              <!-- File Upload Option -->
              <div class="col-md-6 mb-3">
                <label for="{{ form.profile_picture.id_for_label }}" class="form-label">
                  {{ form.profile_picture.label }}
                  {% if not form.instance.pk %}<span class="text-muted">(Alternative: Upload face photo)</span>{% endif %}
                </label>
                {% render_field form.profile_picture class="form-control" %}
                {% if form.profile_picture.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in form.profile_picture.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                {% endif %}
                {% if form.profile_picture.help_text %}
                  <small class="text-muted">{{ form.profile_picture.help_text }}</small>
                {% endif %}
              </div>

              <!-- Current Profile Picture (for updates) -->
              {% if form.instance.profile_picture %}
                <div class="col-md-6 mb-3">
                  <label class="form-label">Current Profile Picture</label>
                  <div class="d-flex align-items-center gap-3">
                    <img src="{{ form.instance.profile_picture.url }}" alt="Current Profile" class="rounded-circle profile-preview">
                    <div>
                      {% if form.instance.face_registered %}
                        <p class="mb-1 text-success">✓ Face recognition active</p>
                        <small class="text-muted">Registered: {{ form.instance.face_registered_at|date:"M d, Y H:i" }}</small>
                      {% else %}
                        <p class="mb-1 text-warning">⚠ Face not registered</p>
                        <small class="text-muted">Upload new photo to enable face recognition</small>
                      {% endif %}
                    </div>
                  </div>
                </div>
              {% endif %}
            </div>

            <!-- Password (only for new employees) -->
            {% if not form.instance.pk %}
              <div class="row mb-4">
                <div class="col-12">
                  <h6 class="text-primary mb-3">Account Password</h6>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="{{ form.password.id_for_label }}" class="form-label">
                    {{ form.password.label }}
                    <span class="text-danger">*</span>
                  </label>
                  {% render_field form.password class="form-control" %}
                  {% if form.password.errors %}
                    <div class="text-danger small mt-1">
                      {% for error in form.password.errors %}
                        {{ error }}
                      {% endfor %}
                    </div>
                  {% endif %}
                  {% if form.password.help_text %}
                    <small class="text-muted">{{ form.password.help_text }}</small>
                  {% endif %}
                </div>
                <div class="col-md-6 mb-3">
                  <label for="{{ form.confirm_password.id_for_label }}" class="form-label">
                    Confirm Password
                    <span class="text-danger">*</span>
                  </label>
                  {% render_field form.confirm_password class="form-control" %}
                  {% if form.confirm_password.errors %}
                    <div class="text-danger small mt-1">
                      {% for error in form.confirm_password.errors %}
                        {{ error }}
                      {% endfor %}
                    </div>
                  {% endif %}
                  {% if form.confirm_password.help_text %}
                    <small class="text-muted">{{ form.confirm_password.help_text }}</small>
                  {% endif %}
                </div>
              </div>
            {% endif %}

            <!-- Form Actions -->
            <div class="row">
              <div class="col-12">
                <div class="d-flex justify-content-end gap-3">
                  <a href="{% url 'employees:employee_list' %}" class="btn btn-outline-secondary">Cancel</a>
                  <button type="submit" class="btn btn-primary">
                    {% if form.instance.pk %}
                      <i class="icon-base bx bx-save me-1"></i>Update Employee
                    {% else %}
                      <i class="icon-base bx bx-plus me-1"></i>Create Employee
                    {% endif %}
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block page_js %}
  {{ block.super }}
  <script>
    // Handle 'Same as Current Address' functionality
    document.addEventListener('DOMContentLoaded', function() {
      const sameAsCurrentCheckbox = document.getElementById('sameAsCurrentAddress');
      const currentAddressField = document.getElementById('{{ form.current_address.id_for_label }}');
      const permanentAddressField = document.getElementById('{{ form.permanent_address.id_for_label }}');

      if (sameAsCurrentCheckbox && currentAddressField && permanentAddressField) {
        // Initial check
        if (currentAddressField.value && !permanentAddressField.value) {
          sameAsCurrentCheckbox.checked = true;
          permanentAddressField.value = currentAddressField.value;
        }

        // Add event listener for checkbox change
        sameAsCurrentCheckbox.addEventListener('change', function() {
          if (this.checked) {
            permanentAddressField.value = currentAddressField.value;
            permanentAddressField.readOnly = true;
          } else {
            permanentAddressField.readOnly = false;
          }
        });

        // Update permanent address when current address changes and checkbox is checked
        currentAddressField.addEventListener('input', function() {
          if (sameAsCurrentCheckbox.checked) {
            permanentAddressField.value = this.value;
          }
        });
      }
    });
    document.addEventListener('DOMContentLoaded', function() {
      // Auto-format PAN card to uppercase
      const panInput = document.getElementById('{{ form.pan_card.id_for_label }}');
      if (panInput) {
        panInput.addEventListener('input', function() {
          this.value = this.value.toUpperCase();
        });
      }

      // Auto-format IFSC code to uppercase
      const ifscInput = document.getElementById('{{ form.ifsc_code.id_for_label }}');
      if (ifscInput) {
        ifscInput.addEventListener('input', function() {
          this.value = this.value.toUpperCase();
        });
      }

      // Format Aadhar number to only numbers
      const aadharInput = document.getElementById('{{ form.aadhar_card_number.id_for_label }}');
      if (aadharInput) {
        aadharInput.addEventListener('input', function() {
          this.value = this.value.replace(/\D/g, '');
        });
      }

      // Format account number to only numbers
      const accountInput = document.getElementById('{{ form.account_number.id_for_label }}');
      if (accountInput) {
        accountInput.addEventListener('input', function() {
          this.value = this.value.replace(/\D/g, '');
        });
      }

      // Profile Picture Camera Functionality (only for new employees)
      {% if not form.instance.pk %}
      const profileCamera = document.getElementById('profile-camera');
      const profileCanvas = document.getElementById('profile-canvas');
      const profileStartBtn = document.getElementById('profile-start-camera-btn');
      const profileCaptureBtn = document.getElementById('profile-capture-btn');
      const profileRetakeBtn = document.getElementById('profile-retake-btn');
      const profilePhotoInput = document.getElementById('profile-photo-data');
      const faceEncodingInput = document.getElementById('face-encoding-data');
      const profilePhotoPreview = document.getElementById('profile-photo-preview');
      const profileCapturedPhoto = document.getElementById('profile-captured-photo');
      const faceStatus = document.getElementById('face-status');
      const formElement = document.querySelector('form');

      let profileStream = null;
      let profileImageData = null;
      let faceEncoding = null;

      // Initialize profile camera
      async function initProfileCamera() {
        try {
          profileStream = await navigator.mediaDevices.getUserMedia({
            video: {
              width: { ideal: 640 },
              height: { ideal: 480 },
              facingMode: 'user'
            },
            audio: false
          });

          profileCamera.srcObject = profileStream;
          profileCaptureBtn.disabled = false;
          profileCaptureBtn.innerHTML = '<i class="icon-base bx bx-camera me-1"></i>Capture Face';

        } catch (error) {
          console.error('Profile camera access denied or not available:', error);
          profileCaptureBtn.innerHTML = '<i class="icon-base bx bx-error me-1"></i>Camera Not Available';
          profileCaptureBtn.disabled = true;

          // Show upload only option
          showProfileUploadOption();
        }
      }

      // Show upload option for profile
      function showProfileUploadOption() {
        const uploadSection = document.createElement('div');
        uploadSection.className = 'mt-3';
        uploadSection.innerHTML = `
          <div class="alert alert-warning">
            <i class="icon-base bx bx-camera-off me-1"></i>
            Camera not available. Please use the file upload option instead. Face recognition will be processed from the uploaded image.
          </div>
        `;
        document.querySelector('.camera-section').appendChild(uploadSection);
      }

      // Process face recognition from image data
      async function processFaceRecognition(imageData) {
        try {
          faceStatus.innerHTML = '<small class="text-info">🔍 Detecting face...</small>';

          // Convert data URL to blob
          const response = await fetch(imageData);
          const blob = await response.blob();

          // Create a temporary file object
          const file = new File([blob], 'face.jpg', { type: 'image/jpeg' });

          // Here you would typically send to backend for face processing
          // For now, we'll simulate the face detection
          setTimeout(() => {
            // Simulate face detection success
            faceStatus.innerHTML = '<small class="text-success">✅ Face detected and registered!</small>';
            faceEncoding = 'simulated_encoding_data'; // In real implementation, this would be actual encoding
            faceEncodingInput.value = faceEncoding;
          }, 2000);

        } catch (error) {
          console.error('Face recognition error:', error);
          faceStatus.innerHTML = '<small class="text-danger">❌ Face detection failed. Please try again.</small>';
        }
      }

      // Capture profile photo
      function captureProfilePhoto() {
        const context = profileCanvas.getContext('2d');
        profileCanvas.width = profileCamera.videoWidth;
        profileCanvas.height = profileCamera.videoHeight;

        context.drawImage(profileCamera, 0, 0, profileCanvas.width, profileCanvas.height);

        profileImageData = profileCanvas.toDataURL('image/jpeg', 0.8);
        profileCapturedPhoto.src = profileImageData;

        // Show preview
        profileCamera.style.display = 'none';
        profilePhotoPreview.classList.remove('d-none');
        profileCaptureBtn.classList.add('d-none');
        profileRetakeBtn.classList.remove('d-none');

        // Process face recognition
        processFaceRecognition(profileImageData);
      }

      // Retake profile photo
      function retakeProfilePhoto() {
        profileCamera.style.display = 'block';
        profilePhotoPreview.classList.add('d-none');
        profileCaptureBtn.classList.remove('d-none');
        profileRetakeBtn.classList.add('d-none');
        profileImageData = null;
        faceEncoding = null;
        faceEncodingInput.value = '';
        faceStatus.innerHTML = '<small class="text-muted">Ready for face capture</small>';
      }

      // Submit form with profile photo data
      function submitProfileForm(e) {
        if (profileImageData) {
          // Convert data URL to blob and create file
          fetch(profileImageData)
            .then(res => res.blob())
            .then(blob => {
              const file = new File([blob], 'profile-photo.jpg', { type: 'image/jpeg' });
              const dt = new DataTransfer();
              dt.items.add(file);

              // Set the file in the profile_picture input
              const profilePictureInput = document.getElementById('{{ form.profile_picture.id_for_label }}');
              profilePictureInput.files = dt.files;
            })
            .then(() => {
              formElement.submit();
            });
        } else {
          // No photo captured, let form submit normally
          formElement.submit();
        }
      }

      // Event listeners for profile camera
      if (profileCaptureBtn) {
        profileCaptureBtn.addEventListener('click', captureProfilePhoto);
        profileRetakeBtn.addEventListener('click', retakeProfilePhoto);

        // Start camera on button click instead of auto-start
        if (profileStartBtn) {
          profileStartBtn.addEventListener('click', function() {
            initProfileCamera();
            profileStartBtn.disabled = true;
          });
        }

        // Handle form submission
        formElement.addEventListener('submit', function(e) {
          if (profileImageData) {
            e.preventDefault();
            submitProfileForm(e);
          }
          // If no photo, let form submit normally
        });

        // Stop camera when navigating away
        window.addEventListener('beforeunload', function() {
          if (profileStream) {
            profileStream.getTracks().forEach(track => track.stop());
          }
        });
      }
      {% endif %}
    });
  </script>
{% endblock %}

{% block vendor_css %}
  {{ block.super }}
  <style>
    .camera-preview {
      width: 100%;
      max-width: 400px;
      height: auto;
      border-radius: 12px;
      border: 2px solid #e9ecef;
      background: #f8f9fa;
    }

    .camera-container {
      position: relative;
      display: inline-block;
    }

    .camera-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
    }

    .photo-preview {
      max-width: 100%;
      max-height: 250px;
      border-radius: 12px;
      border: 2px solid #e9ecef;
    }

    .profile-preview {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border: 3px solid #e9ecef;
    }

    #profile-capture-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .camera-section {
      padding: 1rem;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      background: #f8f9fa;
    }

    @media (max-width: 768px) {
      .camera-controls {
        flex-direction: column;
        gap: 0.5rem;
      }

      .camera-preview {
        max-width: 100%;
      }
    }
  </style>
{% endblock %}
